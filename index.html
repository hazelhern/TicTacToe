<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tic Tac Toe Game</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#10b981; --muted:#9aa4b2;
    --x:#e11d48; --o:#60a5fa;
    font-family:Inter,system-ui,Arial,sans-serif;
  }
  body{background:#0b1220;color:#e6eef6;margin:0;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px;}
  .app{width:900px;max-width:100%;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(0,0,0,0.06));border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6);}
  header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;}
  .controls select,.controls button{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;}
  button{cursor:pointer;background:var(--accent);color:#042018;font-weight:600;border:none;}
  .main{display:flex;gap:20px;margin-top:12px;}
  .board{width:360px;height:360px;display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:6px;padding:6px;background:#071029;border-radius:10px;position:relative;}
  .cell{background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-size:56px;font-weight:800;border-radius:8px;cursor:pointer;transition:transform .08s;user-select:none;}
  .cell:hover{transform:translateY(-3px);}
  .x{color:var(--x);}
  .o{color:var(--o);}
  .cell.disabled{opacity:0.6;cursor:not-allowed;transform:none;}
  .sidebar{flex:1;min-width:260px;}
  .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;margin-bottom:10px;}
  .metric{display:flex;justify-content:space-between;color:var(--muted);font-size:14px;}
  .turn{font-weight:700;font-size:16px;}
  .win-line {
  position: absolute;
  height: 6px;
  background: var(--accent);
  border-radius: 3px;
  transform-origin: center center;
  transform: translate(-50%, -50%) scaleX(0);
  transition: transform 300ms ease;
  opacity: 1;}
  @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
  .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;opacity:0;pointer-events:none;transition:opacity .4s;}
  .overlay.active{opacity:1;pointer-events:auto;}
  .overlay h1{font-size:48px;margin-bottom:20px;}
  .overlay button{font-size:18px;padding:10px 18px;border-radius:8px;}
</style>
</head>
<body>
<div class="app">
  <header>
    <div><strong>Tic Tac Toe AI</strong></div>
    <div class="controls">
      <select id="mode">
        <option value="human">Human vs Human</option>
        <option value="human-ai">Human vs AI</option>
        <option value="ai-ai">AI vs AI</option>
      </select>
      <select id="algorithm">
        <option value="minimax">Minimax</option>
        <option value="alphabeta">Alpha Beta</option>
      </select>
      <select id="aiFor">
        <option value="O">AI = O (second)</option>
        <option value="X">AI = X (first)</option>
      </select>
      <button id="restart">Restart</button>
      <button id="startBattle" style="display:none;">Start Game</button>
      <button id="startAI" style="display:none;">Start Game</button>
    </div>
  </header>

  <div class="main">
    <div class="board" id="board"></div>
    <div class="sidebar">
      <div class="card"><div class="turn">Turn: <span id="turnPlayer">X</span></div></div>
      <div class="card" id="perfCard" style="display:none;">
        <div style="font-weight:700;margin-bottom:6px;">Performance (Real-time)</div>
        <div class="metric"><span>Decision time</span><span id="time">0 ms</span></div>
        <div class="metric"><span>Nodes explored</span><span id="nodes">0</span></div>
        <div class="metric"><span>Pruned</span><span id="pruned">0</span></div>
        <div class="metric"><span>Pruning Efficiency</span><span id="efficiency">0%</span></div>
      </div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <h1 id="overlayText"></h1>
  <button id="overlayRestart">Restart</button>
</div>

<script>
//global state
let board = Array(9).fill(null);
let currentPlayer = 'X', mode = 'human', algorithm = 'minimax', aiFor = 'O';
let boardDisabled = false, awaitingAI = false, autoPlaying = false;
const aiDelay = 700;

//UI references
const boardEl = document.getElementById('board'),
      turnEl = document.getElementById('turnPlayer'),
      timeEl = document.getElementById('time'),
      nodesEl = document.getElementById('nodes'),
      prunedEl = document.getElementById('pruned'),
      perfCard = document.getElementById('perfCard'),
      overlay = document.getElementById('overlay'),
      overlayText = document.getElementById('overlayText'),
      startBattleBtn = document.getElementById('startBattle'),
      startAIBtn = document.getElementById('startAI'),
      aiForEl = document.getElementById('aiFor');

//worker code
const workerCode = `
onmessage = e => {
  const { board, player, algorithm } = e.data;
  let nodes = 0, pruned = 0, lastPost = 0;
  const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  const win = b => { for (const [a,b1,c] of lines) if (b[a] && b[a]===b[b1] && b[a]===b[c]) return b[a]; return null; };
  const full = b => b.every(Boolean);
  const score = (b,p) => win(b)===p ? 10 : win(b)&&win(b)!==p ? -10 : 0;
  function maybePost() {
    nodes++;
    const now = performance.now();
    if (now - lastPost > 50) { postMessage({ type:'progress', nodes, pruned }); lastPost = now; }
  }
  function minimax(b, maxim, p) {
    maybePost();
    const w = win(b);
    if (w || full(b)) return { score: score(b,p), i: -1 };
    let bestScore = maxim ? -1e9 : 1e9, moves = [];
    for (let i=0;i<9;i++) if (!b[i]) {
      b[i] = maxim ? p : (p==='X'?'O':'X');
      const r = minimax(b, !maxim, p);
      b[i] = null;
      if (maxim && r.score >= bestScore) {
        if (r.score > bestScore) { moves=[]; bestScore=r.score; }
        moves.push(i);
      }
      if (!maxim && r.score <= bestScore) {
        if (r.score < bestScore) { moves=[]; bestScore=r.score; }
        moves.push(i);
      }
    }
    const choice = moves[Math.floor(Math.random()*moves.length)];
    return { score: bestScore, i: choice };
  }
  function ab(b, d, a, beta, maxim, p) {
    maybePost();
    const w = win(b);
    if (w || full(b) || d===0) return { score: score(b,p), i: -1 };
    let bestScore = maxim ? -1e9 : 1e9, moves = [];
    for (let i=0;i<9;i++) if (!b[i]) {
      b[i] = maxim ? p : (p==='X'?'O':'X');
      const r = ab(b, d-1, a, beta, !maxim, p);
      b[i] = null;
      if (maxim && r.score >= bestScore) {
        if (r.score > bestScore) { moves=[]; bestScore=r.score; }
        moves.push(i); a = Math.max(a, bestScore);
      }
      if (!maxim && r.score <= bestScore) {
        if (r.score < bestScore) { moves=[]; bestScore=r.score; }
        moves.push(i); beta = Math.min(beta, bestScore);
      }
      if (beta <= a) { pruned++; break; }
    }
    const choice = moves[Math.floor(Math.random()*moves.length)];
    return { score: bestScore, i: choice };
  }
  const depth = 9 - board.filter(Boolean).length;
  const start = performance.now();
  const res = (algorithm==='alphabeta' ? ab : minimax)(board.slice(), depth, -1e9, 1e9, true, player);
  const elapsed = performance.now() - start;
  postMessage({ type:'done', i:res.i, time:elapsed, nodes, pruned });
};
`;
let worker;
function createWorker() {
  if (worker) worker.terminate();
  const blob = new Blob([workerCode], { type:'application/javascript' });
  const url = URL.createObjectURL(blob);
  worker = new Worker(url);
  worker.onmessage = e => {
    if (e.data.type === 'progress') {
  const { nodes, pruned } = e.data;
  nodesEl.textContent = nodes;
  prunedEl.textContent = pruned;
  const efficiency = (pruned / (nodes + pruned)) * 100;
  document.getElementById('efficiency').textContent =
    isFinite(efficiency) ? efficiency.toFixed(1) + '%' : '0%';
}
    if (e.data.type === 'done') {
  const { i, time, nodes, pruned } = e.data;
  timeEl.textContent = Math.round(time) + ' ms';
  nodesEl.textContent = nodes;
  prunedEl.textContent = pruned;
  const efficiency = (pruned / (nodes + pruned)) * 100;
  document.getElementById('efficiency').textContent =
    isFinite(efficiency) ? efficiency.toFixed(1) + '%' : '0%';
  awaitingAI = false; boardDisabled = false;
  if (i >= 0 && !board[i]) makeMove(i, currentPlayer);
}
  };
}

//game logic
function renderBoard() {
  boardEl.innerHTML = '';
  for (let i=0;i<9;i++) {
    const cell = document.createElement('div');
    cell.className = 'cell' + (board[i] ? ' disabled' : '');
    if (board[i]) { cell.textContent = board[i]; cell.classList.add(board[i].toLowerCase()); }
    cell.onclick = () => {
      if (boardDisabled || awaitingAI || board[i]) return;
      if (mode==='human' || (mode==='human-ai' && aiFor!==currentPlayer)) makeMove(i,currentPlayer);
    };
    boardEl.appendChild(cell);
  }
}
function makeMove(i,p) {
  board[i] = p; renderBoard();
  const w = winner(board);
  if (w || boardFull(board)) return endGame(w);
  currentPlayer = (p==='X'?'O':'X'); turnEl.textContent = currentPlayer;
  if (mode==='human-ai' && aiFor===currentPlayer) runAI();
}
function winner(b) {
  const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for (const [a,b1,c] of lines)
    if (b[a] && b[a]===b[b1] && b[a]===b[c]) { drawLine(a,b1,c); return b[a]; }
  return null;
}
function boardFull(b) { return b.every(Boolean); }

function drawLine(a, b1, c) {
  const cells = [...boardEl.children];
  const rectA = cells[a].getBoundingClientRect();
  const rectC = cells[c].getBoundingClientRect();
  const boardRect = boardEl.getBoundingClientRect();

  // center points of each cell relative to board top-left
  const x1 = rectA.left + rectA.width / 2 - boardRect.left;
  const y1 = rectA.top + rectA.height / 2 - boardRect.top;
  const x2 = rectC.left + rectC.width / 2 - boardRect.left;
  const y2 = rectC.top + rectC.height / 2 - boardRect.top;

  // midpoint
  const midX = (x1 + x2) / 2;
  const midY = (y1 + y2) / 2;

  // length and angle for the line
  const length = Math.hypot(x2 - x1, y2 - y1);
  const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;

  // create the line
  const line = document.createElement('div');
  line.className = 'win-line';

  // set width to length, and position at midpoint
  line.style.width = length + 'px';
  line.style.left = midX + 'px';
  line.style.top = midY + 'px';

  // initial transform: centered at midpoint, rotated, but scaled X = 0 (invisible)
  line.style.transform = 'translate(-50%, -50%) rotate(' + angle + 'deg) scaleX(0)';

  boardEl.appendChild(line);

  requestAnimationFrame(() => {
    // animate to full length
    line.style.transform = 'translate(-50%, -50%) rotate(' + angle + 'deg) scaleX(1)';
  });
}

function endGame(w) {
  boardDisabled=true; overlay.classList.add('active');
  overlayText.textContent = w ? (w+' WINS!') : 'DRAW';
  autoPlaying=false;
}
function runAI() { awaitingAI=true; boardDisabled=true; createWorker(); worker.postMessage({board,player:currentPlayer,algorithm}); }
function reset() {
  board=Array(9).fill(null); currentPlayer='X'; boardDisabled=false; awaitingAI=false; autoPlaying=false;
  document.querySelectorAll('.win-line').forEach(l=>l.remove());
  renderBoard(); turnEl.textContent='X'; overlay.classList.remove('active');
  nodesEl.textContent='0'; prunedEl.textContent='0'; timeEl.textContent='0 ms';
}
function autoPlayStep() {
  if (!autoPlaying||boardDisabled) return;
  runAI();
  const check=setInterval(()=>{
    if (!awaitingAI) {
      clearInterval(check);
      if (!winner(board)&&!boardFull(board)&&autoPlaying) setTimeout(autoPlayStep, aiDelay);
    }
  },100);
}

//the controls
document.getElementById('mode').onchange = e => {
  mode = e.target.value;
  startBattleBtn.style.display = (mode==='ai-ai')?'inline-block':'none';
  aiForEl.style.display = (mode==='ai-ai')?'none':'inline-block';
  startAIBtn.style.display = (mode==='human-ai'&&aiFor==='X')?'inline-block':'none';
  perfCard.style.display = (mode==='human-ai'||mode==='ai-ai')?'block':'none';
  reset();
};
document.getElementById('algorithm').onchange = e => algorithm = e.target.value;
aiForEl.onchange = e => {
  aiFor = e.target.value;
  startAIBtn.style.display = (mode==='human-ai'&&aiFor==='X')?'inline-block':'none';
};
document.getElementById('restart').onclick = reset;
document.getElementById('overlayRestart').onclick = reset;

startBattleBtn.onclick = () => {
  if (mode!=='ai-ai') return;
  reset(); autoPlaying=true; setTimeout(autoPlayStep, aiDelay);
};
startAIBtn.onclick = () => {
  if (mode==='human-ai' && aiFor==='X') { reset(); runAI(); }
};

renderBoard();
</script>
</body>
</html>